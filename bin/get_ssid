#!/usr/bin/env bash
set -euo pipefail

is_mac() { [[ "$(echo "$OSTYPE" | tr '[:upper:]' '[:lower:]')" =~ darwin ]]; }

get_ssid() {
    local wifi_device
    local ip
    if is_mac; then
        wifi_device=$(networksetup -listnetworkserviceorder | sed -En 's/^\(Hardware Port: (Wi-Fi|AirPort), Device: (en[0-9]+)\)$/\2/p')
        if [[ -z "$wifi_device" ]]; then
            wifi_device=$(networksetup -listallhardwareports 2>/dev/null | awk '/Wi-Fi/{getline; print $2}')
        fi
        if [[ -n "$wifi_device" ]]; then
            ip=$(ifconfig "$wifi_device" 2>/dev/null | awk '$1=="inet"{print $2; exit}')
            if [[ -n "$ip" ]]; then
                echo "#[fg=green]$ip#[default]"
                return 0
            fi
        fi
    fi
    echo "#[fg=red]no_wifi#[default]"
    return 1
}

get_ssid
